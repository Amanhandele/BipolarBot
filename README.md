# BipolarBot

Телеграм-бот для ведения дневника настроения и анализа снов при биполярном расстройстве.

## Возможности
* **Быстрый чек‑ин.** Бот задаёт несколько простых вопросов о настроении, уровне энергии и самочувствии, чтобы быстро сохранить ваше состояние за день.
* **Дневник снов.** Тексты сновидений сохраняются и анализируются: бот делает краткий юнгианский разбор и вычисляет показатель CIM‑score (Central Image Method). Метрики сохраняются в JSON и доступны в разделе «CIM‑анализ».
* **Графики и спектральный анализ.** По сохранённым данным строятся наглядные графики. Спектральный анализ помогает выявить повторяющиеся циклы настроения.
* **Экспорт и пропуски.** Все записи можно выгрузить в архив, а также увидеть дни, когда вы забыли сделать отметку.
* **Защита паролем.** Ваш дневник хранится в зашифрованном виде (AES), чтобы посторонние не прочитали личные записи.
* **Гибкие напоминания.** Бот присылает напоминания утром и вечером в указанное время, используя внутренний планировщик задач.

## Установка
1. Создайте виртуальное окружение и установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```
2. Создайте файл `Token.py` рядом с `bot.py` и укажите в нём:
   ```python
   API_TOKEN = "<токен от BotFather>"
   AUTHORIZED_USER_IDS = [123456789]  # Ваш ID без кавычек
   OPENAI_API_KEY = "<ключ OpenAI для анализа снов>"
   ```
3. Запустите бота командой:
   ```bash
   python bot.py
   ```

Данные пользователей сохраняются в каталоге `data/` внутри проекта.


## Получение идентификатора и токена
Чтобы бот работал только с вами, необходимо указать свой Telegram ID и токен бота.

### Как узнать ID
1. Откройте диалог с ботом [@getmyid_bot](https://t.me/getmyid_bot).
2. Нажмите «Start». Бот пришлёт два значения: `UserID` и `ChatID`.
3. Скопируйте число из строки **UserID** — его и нужно внести в `Token.py` без кавычек.

### Как получить токен
1. Перейдите к официальному боту [BotFather](https://t.me/BotFather) и нажмите `Start`.
2. Отправьте команду `/newbot`.
3. В ответ введите произвольное название бота, например `Bipolar Dream Bot`.
4. Далее введите уникальный username, который должен оканчиваться на `bot`, например `bipolar_dream_bot`.
5. После этого BotFather пришлёт сообщение с API токеном вида `123456:ABC-DEF...` — скопируйте его и сохраните.
6. При необходимости вернуться к токену можно через `/mybots` → *ваш бот* → `API Token`.

Полученный ID и токен впишите в файл `Token.py` из раздела «Установка».

## Получение ключа OpenAI
1. Зарегистрируйтесь на [platform.openai.com](https://platform.openai.com/) или войдите в существующий аккаунт.
2. Перейдите на страницу [API Keys](https://platform.openai.com/account/api-keys).
3. Нажмите `Create new secret key` и скопируйте полученную строку.
4. Вставьте ключ в `Token.py` в кавычках.
5. Стоимость модели gpt-4o составляет $0.005 за 1000 входных токенов и $0.015 за 1000 выходных.
   Пример запроса с 3500 выходными токенами и примерно 500 входными обойдётся около $0.055 (≈5 руб. при курсе 90 руб/долл).

## Подготовка Python
Проект проверен только на Python 3.9 под Windows. Если Python у вас не установлен:
1. Скачайте дистрибутив x64 по ссылке: [python.org](https://www.python.org/ftp/python/3.9.13/python-3.9.13-amd64.exe).
2. Запустите установку и обязательно отметьте пункт «Add Python to PATH».
3. После установки откройте новую командную строку и убедитесь, что команда `python --version` выводит версию 3.9.

Теперь можно переходить к установке зависимостей и запуску бота.

## Зачем анализировать сны?
Анализ сновидений часто используется в психотерапии и может поддержать людей с биполярным аффективным расстройством. Свободный доступ к исследованиям подтверждает эффективность такого подхода. Например, работа «Dreaming in Bipolar Disorders — Feasibility of the Central Image Method: A Prospective Controlled Trial» описывает применение метода CIM и доступна на ResearchGate: <https://www.researchgate.net/publication/384061302_Dreaming_in_Bipolar_Disorders_-_Feasibility_of_the_Central_Image_Method_A_Prospective_Controlled_Trial>.
